---
title: "Relatório da Encuesta de los centros y profesionales"
author: "Henrique Gomide"
publisher: "CREPEIA"
date: "12 Jun 2017"
output:
  tufte::tufte_book: default
  tufte::tufte_html: default
  word_document:
    fig_height: 3
    fig_width: 5
  pdf_document:
    fig_height: 3
    fig_width: 5
    toc: yes
  html_document:
    fig_height: 3
    fig_width: 5
    toc: yes
header-includes: \usepackage[brazilian]{babel}
---


\tableofcontents

\listoffigures

\listoftables

```{r, setup, include=FALSE}
# Load packages
require(mosaic)   
library(knitr)
library(ggplot2)
library(ggthemes)
library(ggmap)
library(scales)
library(car)
library(dplyr)

# Some customization.  You can alter or delete as desired (if you know what you are doing).
options(OutDec= ",")

trellis.par.set(theme=theme.mosaic()) # change default color scheme for lattice
knitr::opts_chunk$set(
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code

# Carregar banco de dados da cicad
cicad <- read.csv("../../db/cicad.csv", stringsAsFactors = FALSE)
students <- subset(cicad, cicad$intro_question.initial_question == "student")
```

\newpage

<!-- # Sumário Executivo -->

<!-- ## Resultados principais -->


<!-- Profissionais de saúde -->

<!-- 1. -->
<!-- 2. -->
<!-- 3. -->
<!-- 4. -->
<!-- 5.  -->

<!-- Centros de formação -->

<!-- 1. -->
<!-- 2. -->
<!-- 3. -->
<!-- 4. -->
<!-- 5.  -->

\newpage
<p style="page-break-before: always">

# Metodologia

## Instrumento de coleta de dados

Para assegurar a qualidade do instrumento de coleta, seu desenvolvimento foi conduzido em múltiplas etapas. 

Inicialmente, criamos a primeira versão do questionário com base em pesquisas publicadas pelo grupo de pesquisa anteriormente (#citar). As questões foram traduzidas por uma nativa em espanhol e aprovadas pela CICAD. Após terminada a primeira versão, pré-testes foram conduzidos com o público-alvo no Brasil (N = 4) e Colômbia (N = 1). A partir, das avaliações e observações dos pré-testes, desenvolvemos a versão eletrônica do questionário, usando as plataformas [XLSForms](http://xlsform.org) e [Ona](https://ona.io). Todo o código de criação está documentado no repositório da pesquisa no site [Github](https://github.com/henriquepgomide/cicad/).[^1]. 

[^1]: A versão de coleta do instrumento pode está disponível no link: [https://enketo.ona.io/x/#YBfk](https://enketo.ona.io/x/#YBfk)

## Participantes
Os dados apresentados aqui foram coletados via Internet. Para maximar a abrangência da coleta, usamos diversas formas de recrutamento. Primeira, solicitamos a profissionais de excelência o compartilhamento do link com o formulário entre suas redes de contato. Segunda, usamos diferentes listas de profissionais de saúde e centros de formação. Ao todo, foram enviados 43840 e-mails, a quantidade de cliques total foi de 1109 (%2). Os resultados das campanhas são apresentados na tabela abaixo.


```{r echo = FALSE, results = 'asis'}
email_marketing <- read.csv("../../../questionnaire/recruitment/email_marketing_results/email_marketing_results.csv", stringsAsFactors = FALSE, dec = ",")
kable(email_marketing[, c(1,2,5,7,8)], 
      caption = "Resultados do recrutamento feito através de campanhas de e-mail marketing.", 
      digits = 2, align = c("l","c", "c","c","c"),
      col.names = c("Campanha", "N de Destinatários", "Taxa de Abertura", "Cliques", "Taxa de cliques"))
```

A coleta de dados aconteceu entre `r min(as.Date(cicad$start, format = "%Y-%m-%d"))` e `r max(as.Date(cicad$start, format = "%Y-%m-%d"))`. Ao todo, responderam ao questionário `r dim(cicad)[1]` participantes. Destes, 102 responderam as questões ligadas a caracterização dos centros de pesquisa e 839 como profissionais de saúde que realizaram algum treinamento em intervenções breves. Abaixo segue a relação de respostas dentre aqueles que responderam.

```{r echo = FALSE, results = 'asis'}
table0 <- cbind(prop.table(sort(table(cicad$intro_question.initial_question), decreasing = TRUE)))*100
table0 <- cbind(table0,sort(table(cicad$intro_question.initial_question), decreasing = TRUE))
colnames(table0) <- c("Frequência (%)","N")
rownames(table0) <- c("Estudantes", "Nenhum", "Centros")
table0 <- data.frame(table0)

kable(table0,
      caption = "Frequência de respostas dos questionários por tipo.",
      digits = 1,
      col.names = c("%", "N"),
      align = "cc")
```

## Análise dos dados

O primeiro passo da etapa de análise de dados foi a inspeção dos registros. Os registros de teste foram removidos, isto é, todos anteriores à 27 de janeiro de 2017, data da primeira divulgação da pesquisa. Após a retirada dos registros, conduzimos estatísticas descritivas usando a linguagem de programação [R](https://www.r-project.org). Com o intuito de oferecer transparência e garantir a replicabilidade da pesquisa, todos os procedimentos de análises foram disponibilizados neste relatório. Os pacotes necessários para replicar se encontram no apêndice deste relatório.

[//]: # (Inserir aqui os dados da sessão do R que produziu este trabalho.)

# Resultados

Para facilitar a interpretação e leitura, os dados do relatório foram divididos entre as respostas dos profissionais e os centros respondentes.

## Profissionais

### Características Sócio-demográficas

Aproxidamente dois terços da amostra era do sexo feminino (71,6%). Os profissionais tinham média de `r round(mean(students$professionals.demographic_questions.d_age, na.rm = TRUE),1)` (DP = `r round(sd(students$professionals.demographic_questions.d_age, na.rm = TRUE),1)`). A idade entre homens foi mais dispersa quando comparada à das mulheres como indicado na figura. Tivemos a participação de profissionais de 19 países como visto no mapa e na tabela. 

```{r, echo = FALSE, warning = FALSE, fig.margin = TRUE,  fig.cap = "Distribuição de respostas por sexo dos participantes"}
df <- subset(students, !is.na(students$professionals.demographic_questions.d_sex))
df$professionals.demographic_questions.d_sex <- Recode(df$professionals.demographic_questions.d_sex, "'female'='Feminino';'male'='Masculino'")
df$professionals.demographic_questions.d_age <- as.numeric(df$professionals.demographic_questions.d_age)


ggplot(df, aes(x = factor(professionals.demographic_questions.d_sex), y = (..count..)/sum(..count..))) + 
  geom_bar(na.rm = TRUE, fill = "#7cb5ec", width = .5) + xlab("Sexo") + ylab("Frequência (%)") + 
  theme_hc() + scale_colour_hc() + 
  scale_y_continuous(labels = scales::percent)
```

```{r, echo = FALSE, warning = FALSE, fig.margin = TRUE, fig.cap = "Idade por sexo dos participantes"}
ggplot(df, aes(professionals.demographic_questions.d_age, fill = professionals.demographic_questions.d_sex)) + 
  geom_histogram(stat = "count") + 
  xlab("Idade") + ylab("Frequência") + 
  theme_hc() + scale_colour_hc() + 
  scale_fill_manual(name = "Sexo", values = c("#f7a35c", "#7cb5ec"),labels = c("Feminino", "Masculino"))
```

```{r echo = FALSE, fig.margin = TRUE, fig.cap = "Frequência de participação por país"}
countries_data <- data.frame(table(students$professionals.demographic_questions.d_country))
# Recode Countries
countries <- "'arge' = 'Argentina';
'bras' = 'Brazil';
'boli' = 'Bolivia';
'chil' = 'Chile';
'colo' = 'Colombia';
'cost' = 'Costa Rica';
'cuba' = 'Cuba';
'el_s' = 'El Salvador';
'equa' = 'Ecuador';
'guat' = 'Guatemala';
'hait' = 'Haiti';
'hond' = 'Honduras';
'mexi' = 'Mexico';
'nica' = 'Nicaragua';
'pana' = 'Panama';
'para' = 'Paraguay';
'peru' = 'Peru';
'porto_rico' = 'Puerto Rico';
'repu' = 'Dominican Republic';
'sain' = 'Santa Lucia';
'urug' = 'Uruguay';
'vene' = 'Venezuela';"

colnames(countries_data) <- c("country", "freq")
countries_data$country <- as.character(Recode(countries_data$country, countries))
# Plot map
map.world <- map_data("world")
map.world_joined <- left_join(map.world, countries_data, by = c("region" = "country"))
ggplot() + geom_polygon(data = map.world_joined, aes(x = long, y = lat, group = group, fill = cut(freq, 5))) + 
  xlim(-130, -20) + ylim(-60,40) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + 
  coord_equal() + theme_map(base_size = 4) + scale_fill_brewer(name = "Frequência", type = "seq", palette = 1, na.value = "#E5E5E5")
```

```{r, echo = FALSE, results = 'asis'}
countries_table <- filter(countries_data, country != "other")
countries_table <- mutate(countries_table, freq.per = freq / sum(freq)*100)

kable(arrange(countries_table, - freq), 
      caption = "Distribuição dos respondentes por país", 
      digits = 1, align = c("l","c","c"),
      col.names = c("País", "N", "%"))
```

Embora a participação dos profissionais tenha se concentrado nestes países, conseguimos coletar as informações de 20 países distintos. Os três países com o maior número de respostas foram México (57,7%), Brasil (23,0%) e Chile (7,3%).

```{r, echo = FALSE, results = 'asis'}
tb_main_ocupation <- filter(students,
                            !is.na(professionals.demographic_questions.d_main_occupation))
tb_main_ocupation <- data.frame(table(students$professionals.demographic_questions.d_main_occupation))

ocupations <- "
'agen' = 'Agente/líder/educador (a) comunitario (a) en salud';
'assi' = 'Trabajo social';
'enfe' = 'Enfermería';
'fisi' = 'Fisioterapia';
'medi' = 'Medicina';
'nutr' = 'Nutrición';
'dire' = 'Derecho';
'poli' = 'Policía';
'doce' = 'Docencia';
'tecn' = 'Auxiliar/ técnico de enfermería';
'psic' = 'Psicología';
'estud' = 'Estudiante';
'other' = 'Otro';"

colnames(tb_main_ocupation) <- c("Ocupation", "freq")
tb_main_ocupation$Ocupation <- as.character(Recode(tb_main_ocupation$Ocupation, ocupations))

ocupation_table <- mutate(tb_main_ocupation, freq.per = freq / sum(freq)*100)
ocupation_table <- arrange(ocupation_table, - freq)
kable(ocupation_table, 
      caption = "Ocupação principal dos participantes", 
      digits = 1, align = c("l","c","c"),
      col.names = c("Actuación profesional", "N", "%"))
```

A principal área de atuação dos profissionais foi psicologia (56,8%), seguido de assistentes sociais (13,4%), medicina (7,5%) e enfermagem (6,4%). Outras categorias com mais de 30 respostas foram: docência e agentes/líderes/educadores comunitários.


```{r,echo = FALSE, warning = FALSE, fig.margin = TRUE, fig.cap = "Actuación profesional", fig.width=5, fig.height=6}
ggplot(ocupation_table, aes(reorder(Ocupation, freq.per),  freq.per)) + geom_col(fill = "#7cb5ec") +
  coord_flip() + theme_hc() + scale_colour_hc() + 
  labs( 
       x = "",
       y = "Frequência (%)")
```


```{r, echo = FALSE, warning = FALSE, fig.margin = FALSE,  fig.cap = "Posición el el trabajo", fig.width=7, fig.height=5}
workposition <- data.frame(cbind(t(sapply(students[,11:16], function(x) prop.table(table(x))*100, simplify = TRUE))[,2]))
rownames(workposition) <- c("Dirección de la institución","Coordinación de equipo", "Hago parte de un equipo de trabajo","Miembro del cuadro de funcionarios", "Trabajador independiente", "Otro")
colnames(workposition) <- c("freq.per")
workposition$names <-rownames(workposition)

ggplot(workposition, aes(reorder(names, freq.per),  freq.per)) + geom_col(fill = "#7cb5ec") +
  coord_flip() + theme_hc() + scale_colour_hc() +
  labs( 
       x = "",
       y = "Frequência (%)")

```

A maior parte dos profissionais definiu a ocupação como faço parte de uma equipe de trabalho (65,1%), seguido de coordenação de equipe (20,8%) e direção de instituição (8,9%).

### Treinamento

Este é um teste sobre a parte de treinamento. Breve descrição das questões aqui.

